# 7. 보조기억장치
## 하드 디스크
- 하드 디스크(HDD; Hard Disk Drive)
    - 자기적인 방식으로 데이터 저장
    - 자기 디스크(Magnetic Disk)의 일종으로 지칭하기도 함
    - 어디에 활용?
        - 서버..

### 구조
- 플레터(Platter)
    - 데이터가 저장되는 원판으로 자기 물질로 덮여 있어 N극(0)과 S극(1) 저장
        - 트랙(Track)과 섹터(Sector)라는 단위로 데이터를 저장
            - 섹터는 하드 디스크의 가장 작은 전송 단위로 일반적으로 512바이트의 크기
            - 하나 이상의 섹터를 묶어 블록(Block)이라고 표현하기도 함
            - 헤드가 읽어들이는 영역이 트랙(Track)
        - 여러 겹의 플래터 상에서 같은 트랙이 위치한 곳을 모아 연결한 논리적 단위를 실린더(Cylinder)라고 함.
            - 연속된 정보를 보통 실린더에 기록함.
    - 하나의 하드 디스크에는 여러 개의 플래터로 이뤄져 있음
    - 양면 사용 가능
        - 양면 플래터일 시 위아래로 플래터당 두 개의 헤드가 사용됨
- 스핀들(Spindle)
    - 플레터를 회전시키는 요소
    - 스핀들이 플레터를 돌리는 속도는 RPM(Revolution Per Minute)으로 나타냄
- 헤드(Head)
    - 플래터를 대상으로 데이터를 읽고 쓰는 구성 요소
    - 단일 헤드 디스크(Single-Head Disk) / 다중 헤드 디스크(Multiple-Head Disk)
        - 각각 이동 헤드 디스크(Movable-Head Disk) / 고정 헤드 디스크(Fixed-Head Disk)라고도 함
- 디스크 암(Disk Arm)
        - 플래터의 한 면당 헤드의 갯수에 따라 구분
    - 헤드를 이동시키는 구성 요소

### 동작 원리
- 하드 디스크가 저장된 데이터에 접근하는 시간
    - 탐색 시간(Seek Time)
        - 접근하려는 데이터가 저장된 트랙까지 헤드를 이동시키는 시간
    - 회전 지연(Rotational Latency)
        - 헤드가 있는 곳으로 플래터를 회전시키는 시간
    - 전송 시간(Transfer Time)
        - 하드 디스크와 컴퓨터 간에 데이터를 전송하는 시간

- ![하드 디스크 동작 영상](https://youtube.com/shorts/cJ89PVI1VZs?si=EzytCG3OsbTgmDjo)


## 플래시 메모리
- 플래시 메모리(Flash Memory)
    - USB 메모리, SD 카드, SSD, ROM 등 여러 곳에서 활용
    - 전기적으로 데이터를 읽고 쓸 수 있는 반도체 기반의 저장 장치
    - NAND 게이트 기반이냐, NOR 게이트 기반이냐에 따라 각각 NAND 플래시 메모리, NOR 플래시 메모리로 구분함.
        - 이중 대용량 저장 장치로 많이 사용되는 것은 NAND 플래시 메모리

### 구조
- 셀(Cell)
    - 데이터를 저장하는 가장 작은 단위
    - 한 셀에 1비트를 저장한다면 SLC(Single Level Cell)타입, 2비트면 MLC(Multiple Level Cell)타입, 3비트면 TLS(Triple Level Cell)타입이라고 함, 4비트면 QLC(Quad Level Cell)타입
    - 셀은 플래시 메모리의 수명, 속도, 가격에 큰 영향을 미침
- SLC 타입
    - MLC나 TLC 타입에 비해 비트의 빠른 입출력이 가능함.
    - 수명도 긺
    - 용량 대비 가격이 높음
    - 보통 기업에서 데이터를 읽고 쓰기가 매우 많이 반복되며 고성능의 빠른 저장 장치가 필요한 경우에 사용
- MLC 타입
    - SLC보다 속도와 수명은 떨어지나 대용화 하기 유리함
    - 용량 대비 가격이 SLC와 대비에 저렴함
    - 시중에 풀려있는 제품들이 MLC 혹은 TLC 타입
- TLC 타입
    - 수명과 속도가 떨어지나 용량 대비 가격이 저렴함.

### 동작 원리
- Cell => Page => Block => Plane => Die
- 읽기와 쓰기는 페이지 단위
- 삭제는 블록 단위
- 페이지 상태
    - Free
        - 어떠한 데이터도 저장하고 있지 않아 새로운 데이터를 저장할 수 있는 상태
    - Valid
        - 이미 유효한 데이터를 저장하고 있는 상태
    - InValid
        - 유효하지 않은 데이터(쓰레기값)를 저장하고 있는 상태
- 가비지 컬렉션(Garbage Collection)
    - 덮어쓰기가 불가능하므로 쓰레기값을 정리하기 위함.
    - 유효한 페이지만을 새로운 블록으로 복사 후 기존의 블록을 삭제

| 구분 | SLC | MLC | TLC |
| --- | --- | --- | --- |
| 셀당 bit | 1bit | 2bit | 3bit |
| 수명 | 길다 | 보통 | 짧다 |
| 읽기/쓰기 속도 | 빠르다 | 보통 | 느리다 |
| 용량 대비 가격 | 높다 | 보통 | 낮다 |

## RAID
- RAID(Redundant Array of Independent Disks)
    - 데이터의 안전성 혹은 높은 성능을 위해 여러 개의 물리적 보조기억장치를 마치 하나의 논리적 보조기억장치처럼 사용하는 기술
    - 하드 디스크와 SSD를 사용

### 레벨
- RAID 구성하는 기술을 RAID 레벨이라고 함
- RAID 0, RAID 1, RAID 2, RAID 3, RAID 4, RAID 5, RAID 6, RAID 10, RAID 50 등이 있음
    - RAID 10은 RAID 0과 RAID 1을 혼합 / RAID 50은 RAID 0과 RAID 5을 혼합
        - 여러 RAID 레벨을 혼합한 방식을 Nested RAID
#### RAID 0
- 여러 개의 보조기억장치에 데이터를 단순히 나누어 저장하는 구성 방식
- 분산하여 저장하는 방식을 스트라이핑(Striping)이라고 함
    - 분산된 데이터는 스트라입(Stripe)
- 하나의 저장 장치 대비 동시에 읽고 쓸 수 있는 데이터 양이 늘어남.
    - 입출력 속도가 빠름
- 단, 저장된 정보가 안전하지 않음.
    - RAID 0로 구성된 하드 디스크 중 하나에 문제가 생긴다면 다른 모든 디스크의 정보를 읽는 데 문제가 생길 수 있음

#### RAID 1
- 복사본을 만드는 방식
    - 미러링(Mirroring)이라고도 함
- 데이터를 쓸 때는 원본과 복사본 두 군데에 쓰기에 RAID 0 대비 쓰기 속도가 느림
- 복구가 매우 간단함.
- 단, 사용 가능한 용량이 적어짐 => 비용 증가

#### RAID 4
- 패리티 비트(Parity Bit)를 저장한 장치를 이용해 다른 장치들의 오류를 검출하고, 복구함.
    - 원래 오류 검출만 가능하나 RAID에서는 복구까지 가능
- 새로운 데이터가 저장될 때마다 패리티를 저장하는 디스크에도 데이터를 써야 하기 때문에 패리티 비트를 저장하는 장치에 병목 현상이 발생함

#### RAID 5
- 패리티 정보를 분산하여 저장하여 RAID 4 대비 병목 현상 해소
    
#### RAID 6
- 구성은 RAID 5와 같으나 서로 다른 두 개의 패리티를 두는 방식
- RAID 4, RAID 5 대비 더욱 안전한 구성. 다만, 쓰기 속도 희생

- 각 RAID 레벨마다 장단점이 있음
    - 특징을 알고 있어야 함
- 어떤 상황에서 무엇을 최우선으로 원하는지에 따라 최적의 RAID 레벨을 선택해야함

    
# 8. 입출력장치
## 장치 컨트롤러와 장치 드라이버
- 보조기억장치도 입출력장치에 포함
- 입출력장치는 다루기가 까다롭다.
    - 종류가 너무나도 많다. 장치마다 속도, 데이터 전송 형식 등도 다양하기에 이를 규격화하기가 어렵다.
    - 일반적으로 CPU와 메모리의 데이터 전송률(Transfer Rate)에 비해 낮다.
        - 전송률이란 데이터를 얼마나 빨리 교환할 수 있는지를 나타내는 지표

### 장치 컨트롤러(Device Controller)
- 입출력장치는 컴퓨터에 직접 연결되지 않고 장치 컨트롤러라는 하드웨어를 통해 연결됨
- 입출력 제어기(I/O Controller), 입출력 모듈(I/O Module)이라고도 함
- 모든 입출력장치는 각자의 장치 컨트롤러를 통해 컴퓨터 내부와 정보를 주고받고, 장치 컨트롤러는 하나 이상의 입출력장치와 연결됨
- 역할
    - CPU와 입출력장치 간의 통신 중개
    - 오류 검출
    - 데이터 버퍼링(Buffering)
        - 버퍼링 : 전송률이 높은 장치와 낮은 장치 사이에 주고받는 데이터를 버퍼라는 임시 저장 공간에 저장하여 전송률을 비슷하게 맞추는 방법
- 구조
    - 데이터 레지스터(Data Register)
        - 버퍼 역할
        - 최근 주고받는 데이터가 많은 입출력장치에서는 레지스터 대신 RAM을 사용하기도 함
    - 상태 레지스터(Status Register)
        - 상태 정보 저장
            - 입출력장치가 입출력 작업을 할 준비가 되었는지
            - 입출력 작업이 완료되었는지
            - 입출력장치에 오류는 없는지 등의 상태 정보
    - 제어 레지스터(Control Register)
        - 입출력장치가 수행할 내용에 대한 제어 정보와 명령을 저장
- 상태/제어 레지스터를 하나의 레지스터로 사용하기도 함

### 장치 드라이버(Device Driver)
- 장치 컨트롤러의 동작을 감지하고 제어함으로써 장치 컨트롤러가 컴퓨터 내부와 정보를 주고받을 수 있게 하는 프로그램
- 장치 드라이버가 설치되어 있지 않으면 해당 입출력장치를 사용할 수 없음
    - 운영체제가 이를 인식해야 함
- 운영체제 혹은 장치 제작자가 제공
    
## 다양한 입출력 방법
### 프로그램 입출력(Pragrammed I/O)
- 프로그램으로 입출력장치를 제어하는 방법
- CPU가 장치 컨트롤러의 레지스터 값을 읽고 씀으로써 이뤄진다.
- 장치 컨트롤러 속 레지스터를 다루는 방법
    - 메모리 맵 입출력(Memory-Mapped I/O)
        - 메모리에 장치 컨트롤러의 레지스터 데이터를 사상하는 방법
    - 고립형 입출력(Isolated I/O)
        - 입출력 읽기/쓰기 선을 활성화시키는 입출력 명령어 사용

| 메모리 맵 입출력 | 고립형 입출력 |
| 메모리와 입출력장치가 같은 주소 공간 사용 | 메모리와 입출력장치는 분리된 주소 공간 사용 |
| 메모리 주소 공간이 축소됨 | 메모리 주소 공간이 축소되지 않음 |
| 메모리와 입출력장치에 같은 명령어 사용 가능 | 입출력 전용 명령어 사용 |

### 인터럽트 기반 입출력(Interrupt-Driven I/O)
- 입출력장치에 의한 인터럽트는 장치 컨트롤러에 의해 발생함
- 인터럽트를 기반으로 하는 입출력
- 순차적으로 처리
    - NMI가 발생하지 않고 플래그 레지스터의 인터럽트를 비활성화한 경우
- 우선순위를 반영하여 다중 인터럽트를 처리
    - NMI가 발생한 경우
    - 플래그 레지스터의 인터럽트를 활성화한 경우
- 프로그래머블 인터럽트 컨트롤러(PIC; Programmable Interrupt Controller)
    - 여러 장치 컨트롤러에서 보낸 인터럽트의 우선순위를 판별한 뒤 CPU에게 알려줌
        - NMI는 판별이 불필요함.
        - PIC가 다루는 인터럽트는 Maskable Interrupt
    - 각 핀마다 어떤 장치 컨트롤러인지 약속됨
    - 과정
        1. PIC가 장치 컨트롤러에서 인터럽트 요청 신호를 받아들임
        2. PIC는 인터럽트 우선순위를 판단한 뒤 CPU에 처리해야 할 인터럽트 요청 신호를 보냄
        3. CPU는 PIC에 인터럽트 확인 신호를 보냄
        4. PIC는 데이터 버스를 통해 CPU에 인터럽트 벡터를 보냄
        5. CPU는 인터럽트 서비스 루틴 실행

### DMA(Direct Memory Access) 입출력
- 위 두 방법은 메모리와 장치 컨트롤러 레지스터 간 데이터 전송에 CPU가 관여함
    - 장치 컨트롤러 -> CPU -> 메모리
    - 메모리 -> CPU -> 장치 컨트롤러
- CPU가 입출력장치를 위한 연산 때문에 부하가 발생
- 메모리에 직접 접근할 수 있는 입출력 기능
- 시스템 버스에 연결된 DMA 컨트롤러라는 하드웨어가 필요함
    - CPU가 시스템 버스를 이용하지 않을 때마다 조금씩 시스템 버스를 이용하거나, CPU가 일시적으로 시스템 버스를 이용하지 않도록 허락을 구하고 시스템 버스를 집중적으로 이용함. => 사이클 스틸링(Cycle Stealing)
        - DMA 컨트롤러와 장치 컨트롤러들을 입출력 버스(I/O bus)라는 별도의 버스에 연결
            - PCI(Peripheral Component Interconnect) 버스, PCI Express(PCIe) 버스 등
- 과정
    1. CPU는 DMA 컨트롤러에 입출력장치의 주소, 수행할 연산(읽기/쓰기), 읽거나 쓸 메모리의 주소 등과 같은 정보로 입출력 작업을 명령함
    2. DMA 컨트롤러는 CPU 대신 장치 컨트롤러와 상호작용하며 입출력 작업을 수행함. 이때 DMA 컨트롤러는 필요한 경우 메모리에 직접 접근하여 정보를 읽거나 씀
    3. 입출력 작업이 끝나면 DMA 컨트롤러는 CPU에 인터럽트를 걸어 작업이 끝났음을 알림
- 입출력 프로세서(IOP; Input/Output Processor)
    - 입출력 명령어를 직접 인출, 해석, 실행하는 입출력 전용 프로세서
    - CPU가 이에 대해 신경쓰지 않도록 함
    - 입출력 채널(Input/Output Channel)이라고도 함

# 참고자료
- https://youtu.be/wteUW2sL7bc?si=jZtaeDKdH1OTnjAY
- https://youtube.com/shorts/cJ89PVI1VZs?si=EzytCG3OsbTgmDjo