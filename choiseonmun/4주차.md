<style>
    .highlight
    {
        color: red;
    }

    .footnote
    {
        color: gray;
        font-size: 90%;
    }

    img
    {
        display: block;
        margin: auto;
    }

    .img-desc
    {
        color: gray;
        text-align: center;
        margin-bottom: 1%;
    }
</style>

# CPU 성능 향상 기법
## 1. 빠른 CPU를 위한 설계 기법
- 클럭
    - 클럭 속도가 높아지면 CPU는 명령어 사이클을 더 빠르게 반복할 것이고, 다른 부품들도 그에 발맞춰 더 빠르게 작동할 것이다.
    - 클럭 속도가 높은 CPU는 일반적으로 성능이 좋음
    - 헤르츠(Hz) 단위로 측정
        - 1초에 클럭이 몇 번 반복
    - 클럭 속도이 높으면 발열 문제가 발생

- 코어와 멀티코어
    - 코어(Core) : 명령어를 실행하는 부품
        - 오늘날의 CPU는 '명령어를 실행하는 부품'에서 '명령어를 실행하는 부품을 여러 개 포함하는 부품'으로 명칭의 범위가 확장됨
    - 코어를 여러 개 포함하고 있는 CPU를 멀티코어(Multi-core) CPU 또는 멀티코어 프로세서라고 부름
        - Single / Dual / Triple / Quad / Hexa / Octa / Deca / Dodeca
    - 코어마다 처리할 연산이 적절히 분배되지 않는다면 코어 수에 비례하여 연삭 속도가 증가하지 않음.
        - 코어마다 처리할 명령어들을 얼마나 적절하게 분배하느냐이고 그에 따라 연산 속도가 크게 다라짐

- 스레드와 멀티스레드
    - 스레드(Thread) : 실행 흐름의 단위
        - 하드웨어적 스레드(하드웨어 스레드)
            - 하나의 코어가 동시에 처리하는 명령어 단위
        - 소프트웨어적 스레드(스레드)
            - 하나의 프로그램에서 독립적으로 실행되는 단위
    - 하나의 코어로 여러 명령어를 동시에 처리하는 CPU를 멀티스레드(Multithread) 프로세서 또는 멀티스레드 CPU라 함
        - 하이퍼스레딩(Hyper-threading) : 인텔의 멀티스레드 기술
    - 멀티스레드 프로세서
        - 멀티스레드 프로세서 설계의 핵심은 레지스터임.
        - 하드웨어 스레드 == 논리 프로세서(Logical Processor)

- 코어(Core) : 명령어를 실행할 수 있는 하드웨어 부품
- 스레드(Thread) : 명령어를 실행하는 단위
- 멀티코어 프로세서 : 코어가 두 개 이상 있는 CPU
- 멀티스레드 프로세서 : 하나의 코어로 여러 개의 명령어를 동시에 실행할 수 있는 CPU

## 2. 명령어 병렬 처리 기법
- 명령어 병렬 처리 기법(ILP; Instruction-Level Parallelism)
- 명령어 파이프라이닝(Instruction Pipelining)
    - 명령어 파이프라인(Instruction Pipeline)에 넣고 동시에 처리하는 기법
    - 파이프라인 위험(Pipeline Hazard) : 성능 향상에 실패한 경우
        - 데이터 위험(Data Hazard)
            - 명령어 간 '데이터 의존성'에 의해 발생함.
            - 데이터 의존적인 두 명령어를 무작정 동시에 실행하려고 하면 파이프라인이 제대로 작동하지 않는 것
        - 제어 위험(Control Hazard)
            - 분기 등으로 인한 '프로그램 카운터의 갑작스러운 변화'에 의해 발생
            - 명령어 파이프라인에 미리 가지고 와서 처리 중이었던 명령어들은 아무 쓸모가 없어짐
            - 분기 예측(Branch Prediction) : 어디로 분기할지 미리 예측한 후 그 주소를 인출하는 기술
        - 구조적 위험(Structural Hazard)
            - 명령어들을 겹쳐 실행하는 과정에서 서로 다른 명령어가 동시에 ALU, 레지스터 등과 같은 CPU 부품을 사용하려고 할 때
            - 자원 위험(Resouce Hazard)라고도 함
- 슈퍼스칼라
    - CPU 내부에 여러 개의 명령어 파이프라인을 포함한 구조를 슈퍼스칼라(Superscalar)라고 함
    - 슈퍼스칼라 구조로 명령어 처리가 가능한 CPU를 슈퍼스칼라 프로세서 또는 슈퍼스칼라 CPU라고 함
    - 매 클럭 주기마다 동시에 여러 명령어를 인출할 수도, 실행할 수도 이써양 함
    - 이론적으로 파이프라인 개수에 비례하여 프로그램 처리 속도가 빨라짐
        - 하지만 파이프라인 위험 등의 예상치 못한 문제로 실제는 다름. 따라서 고도로 설계되어야 함
    - 멀티스레드 프로세서
- 비순차적 명령어 처리(OoOE; Out-of-Order Execution)
    - 순서를 바꿔 실행해도 무방한 명령어를 먼저 실행하여 명령어 파이프라인이 멈추는 것을 방지하는 기법
    - 비순차적 명령어 처리가 가능한 CPU는 명령어들이 어떤 명령어와 데이터 의존성을 갖고 있는지, 순서를 바꿔 실행할 수 있는 명령어에는 어떤 것들이 있는지를 판단할 수 있어야 함.

## CISC와 RISC
- 명령어 집합
    - CPU가 이해할 수 있는 명령어들의 모음을 명령어 집합(Instruction Set) 또는 명령어 집합 구조(ISA; Instruction Set Architecture)라 함.
    - ISA가 다르면 CPU 하드웨어 설계에 큰 영향을 미침
        - 제어장치가 명령어를 해석하는 방식
        - 사용되는 레지스터의 종류와 개수
        - 메모리 관리 방법 등
- CISC(Complex Instruction Set Computer)
    - x86 / x86-64
    - 가변 길이 명령어 활용
    - 주소 지정 방식도 다양함.
    - 적은 수의 명령어로도 프로그램을 실행할 수 있음 => 프로그램 크기가 작음 => 메모리 고악ㄴ 절약
    - 명령어의 크기와 실행되기까지의 시간이 일정하지 않고, 명령어 하나를 실행하는 데 여러 클럭 주기를 필요로 함
        - 명령어 파이프라인을 구현하는 데 큰 걸림돌이 됨
            - 명령어 파이프라인 기법을 위한 이상적인 명령어는 각 단계에 소요되는 시간이 (가급적 1 클럭으로) 동일해야 함
    - 대다수의 복잡한 명령어는 사용 빈도가 낮음.
        - 1974년 IBM 연구소의 존 코크(John Cocke)는 CISC 명령어 집합 중 20% 정도의 명령어가 사용된 전체 명령어의 80% 가량을 차지한다는 것을 증명함.
    - CISC 명령어 집합은 복잡하고 다양한 기능을 제공하기에 적은 수의 명령으로 프로그램을 동작시키고 메모리를 절약할 수 있지만, ㅇ명령어의 규격화가 어려워 파이프라이닝이 어려움. 그리고 대다수의 복잡한 명령어는 그 사용 빈도가 낮음 -> 성장에 한계가 있음
- RISC(Reduced Instruction Set Computer)
    - 명령어의 길이와 수행 시간이 짧고 규격화하여 명령어 파이프라인을 활용하고, 자주 쓰이는 기본적인 명령어를 작고 빠르게 만듦
    - CISC에 비해 명령어의 종류가 적고, 짧고 규격화된 명령어, 되도록 1클럭 내외로 실행되는 명령어를 지향함 => 고정 길이 명령어
    - 메모리에 직접 접근하는 명령어를 load, store 2개로 제한할 만큼 메모리 접근을 단순화하고 최소화를 추구함. 주소 지정 방식의 종류가 적은 경우가 많음
        - Load-Store 구조
    - 메모리 접근을 단순화, 최소화하는 대신 레지스터를 적극적으로 활용
        - CISC보다 레지스터를 이용하는 연산이 많고, 일반적인 범용 레지스터 개수도 더 많음
    - CISC보다 프로그램 크기가 큼
    - ARM

| CISC | RISC |
| --- | --- |
| 복잡하고 다양한 명령어 | 단순하고 적은 명령어 |
| 가변 길이 명령어 | 고정 길이 명령어 |
| 다양한 주소 지정 방식 | 적은 주소 지정 방식 |
| 프로그램을 이루는 명령어의 수가 적음 | 프로그램을 이루는 명령어의 수가 많음 |
| 여러 클럭에 걸쳐 명령어 수행 | 1클럭 내외로 명령어 수행 |
| 파이프라이닝하기 어려움 | 파이프라이닝하기 쉬움 |

- 현대 CPU의 실제 설계..
    - CISC 실제 실행될 때는 마이크로명령어로 실행함. 즉, 내부적으로는 RISC처럼 실행함.